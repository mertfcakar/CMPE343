<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.*?>

<BorderPane xmlns="http://javafx.com/javafx/21" xmlns:fx="http://javafx.com/fxml/1" 
            fx:controller="com.group12.greengrocer.controllers.OwnerController"
            prefWidth="960" prefHeight="540" style="-fx-background-color: #f5f5f5;">
    
    <!-- TOP: Header -->
    <top>
        <VBox style="-fx-background-color: #6a1b9a; -fx-padding: 15;">
            <HBox alignment="CENTER_LEFT" spacing="20">
                <Label text="Group12 GreenGrocer - Owner Dashboard" style="-fx-text-fill: white; -fx-font-size: 24px; -fx-font-weight: bold;"/>
                <Region HBox.hgrow="ALWAYS"/>
                <Label fx:id="usernameLabel" text="Owner" style="-fx-text-fill: white; -fx-font-size: 16px;"/>
                <Button text="Logout" onAction="#handleLogout" style="-fx-background-color: #c62828; -fx-text-fill: white;"/>
            </HBox>
        </VBox>
    </top>
    
    <!-- CENTER: Main content with TabPane -->
    <center>
        <BorderPane>
            
            <!-- Tab Navigation -->
            <center>
                <TabPane fx:id="mainTabPane" tabClosingPolicy="UNAVAILABLE" style="-fx-background-color: white;">
                    
                    <!-- Dashboard Tab -->
                    <Tab text="Dashboard">
                        <ScrollPane fitToWidth="true" fitToHeight="true">
                            <VBox spacing="20" style="-fx-padding: 20;">
                                
                                <!-- KPI Cards - Modern Design -->
                                <HBox spacing="15">
                                    <VBox spacing="5" style="-fx-background-color: linear-gradient(to bottom, #2196f3, #1976d2); -fx-padding: 20; -fx-border-radius: 10; -fx-background-radius: 10; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.2), 5, 0, 0, 2);" HBox.hgrow="ALWAYS">
                                        <Label text="ðŸ“¦ Total Products" style="-fx-font-size: 14px; -fx-text-fill: white; -fx-opacity: 0.9;"/>
                                        <Label fx:id="totalProductsLabel" text="30" style="-fx-font-size: 36px; -fx-font-weight: bold; -fx-text-fill: white;"/>
                                    </VBox>
                                    <VBox spacing="5" style="-fx-background-color: linear-gradient(to bottom, #4caf50, #388e3c); -fx-padding: 20; -fx-border-radius: 10; -fx-background-radius: 10; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.2), 5, 0, 0, 2);" HBox.hgrow="ALWAYS">
                                        <Label text="ðŸ“‹ Active Orders" style="-fx-font-size: 14px; -fx-text-fill: white; -fx-opacity: 0.9;"/>
                                        <Label fx:id="activeOrdersLabel" text="0" style="-fx-font-size: 36px; -fx-font-weight: bold; -fx-text-fill: white;"/>
                                    </VBox>
                                    <VBox spacing="5" style="-fx-background-color: linear-gradient(to bottom, #ff9800, #f57c00); -fx-padding: 20; -fx-border-radius: 10; -fx-background-radius: 10; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.2), 5, 0, 0, 2);" HBox.hgrow="ALWAYS">
                                        <Label text="ðŸ’° Total Revenue" style="-fx-font-size: 14px; -fx-text-fill: white; -fx-opacity: 0.9;"/>
                                        <Label fx:id="totalRevenueLabel" text="â‚º0.00" style="-fx-font-size: 36px; -fx-font-weight: bold; -fx-text-fill: white;"/>
                                    </VBox>
                                    <VBox spacing="5" style="-fx-background-color: linear-gradient(to bottom, #9c27b0, #7b1fa2); -fx-padding: 20; -fx-border-radius: 10; -fx-background-radius: 10; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.2), 5, 0, 0, 2);" HBox.hgrow="ALWAYS">
                                        <Label text="ðŸšš Active Carriers" style="-fx-font-size: 14px; -fx-text-fill: white; -fx-opacity: 0.9;"/>
                                        <Label fx:id="activeCarriersLabel" text="0" style="-fx-font-size: 36px; -fx-font-weight: bold; -fx-text-fill: white;"/>
                                    </VBox>
                                </HBox>
                                
                                <!-- Charts Section -->
                                <HBox spacing="15">
                                    <!-- Left Column -->
                                    <VBox spacing="15" HBox.hgrow="ALWAYS">
                                        <!-- Most Sold Products Chart -->
                                        <VBox spacing="10" style="-fx-background-color: white; -fx-padding: 15; -fx-border-color: #e0e0e0; -fx-border-width: 1; -fx-border-radius: 5; -fx-background-radius: 5;">
                                            <Label text="ðŸ“Š En Ã‡ok SatÄ±lan ÃœrÃ¼nler (Top 10)" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
                                            <Separator/>
                                            <VBox fx:id="mostSoldProductsChart" prefHeight="250" VBox.vgrow="ALWAYS"/>
                                        </VBox>
                                        
                                        <!-- Revenue by Category Chart -->
                                        <VBox spacing="10" style="-fx-background-color: white; -fx-padding: 15; -fx-border-color: #e0e0e0; -fx-border-width: 1; -fx-border-radius: 5; -fx-background-radius: 5;">
                                            <Label text="ðŸ’° Kategori BazlÄ± Gelir" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
                                            <Separator/>
                                            <VBox fx:id="revenueByCategoryChart" prefHeight="200" VBox.vgrow="ALWAYS"/>
                                        </VBox>
                                    </VBox>
                                    
                                    <!-- Right Column -->
                                    <VBox spacing="15" HBox.hgrow="ALWAYS">
                                        <!-- Carrier Performance Chart -->
                                        <VBox spacing="10" style="-fx-background-color: white; -fx-padding: 15; -fx-border-color: #e0e0e0; -fx-border-width: 1; -fx-border-radius: 5; -fx-background-radius: 5;">
                                            <Label text="ðŸšš Carrier Performans SÄ±ralamasÄ±" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
                                            <Separator/>
                                            <VBox fx:id="carrierPerformanceChart" prefHeight="200" VBox.vgrow="ALWAYS"/>
                                        </VBox>
                                        
                                        <!-- Order Intensity by Hour Chart -->
                                        <VBox spacing="10" style="-fx-background-color: white; -fx-padding: 15; -fx-border-color: #e0e0e0; -fx-border-width: 1; -fx-border-radius: 5; -fx-background-radius: 5;">
                                            <Label text="â° SipariÅŸ YoÄŸunluÄŸu (Saat BazlÄ±)" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
                                            <Separator/>
                                            <VBox fx:id="orderIntensityHourChart" prefHeight="200" VBox.vgrow="ALWAYS"/>
                                        </VBox>
                                        
                                        <!-- Most Active Customers Chart -->
                                        <VBox spacing="10" style="-fx-background-color: white; -fx-padding: 15; -fx-border-color: #e0e0e0; -fx-border-width: 1; -fx-border-radius: 5; -fx-background-radius: 5;">
                                            <Label text="ðŸ‘¥ En Aktif MÃ¼ÅŸteriler (Top 10)" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
                                            <Separator/>
                                            <VBox fx:id="mostActiveCustomersChart" prefHeight="200" VBox.vgrow="ALWAYS"/>
                                        </VBox>
                                    </VBox>
                                </HBox>
                                
                            </VBox>
                        </ScrollPane>
                    </Tab>
                    
                    <!-- Products Management Tab -->
                    <Tab text="Products">
                        <BorderPane>
                            <top>
                                <HBox spacing="10" alignment="CENTER_LEFT" style="-fx-padding: 15; -fx-background-color: #f5f5f5;">
                                    <Button text="Add Product" onAction="#handleAddProduct" style="-fx-background-color: #4caf50; -fx-text-fill: white; -fx-font-weight: bold;"/>
                                    <Button text="Edit Product" onAction="#handleUpdateProduct"/>
                                    <Button text="Remove Product" onAction="#handleRemoveProduct" style="-fx-background-color: #f44336; -fx-text-fill: white;"/>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <TextField fx:id="productSearchField" promptText="Search products..." prefWidth="200"/>
                                    <Button text="Search" onAction="#handleSearchProducts"/>
                                </HBox>
                            </top>
                            <center>
                                <TableView fx:id="productsTable" style="-fx-background-color: white;">
                                    <columns>
                                        <TableColumn text="ID" prefWidth="50">
                                            <style>
                                                -fx-background-color: #f5f5f5;
                                                -fx-font-weight: bold;
                                            </style>
                                        </TableColumn>
                                        <TableColumn text="Name" prefWidth="150"/>
                                        <TableColumn text="Type" prefWidth="100"/>
                                        <TableColumn text="Base Price" prefWidth="100"/>
                                        <TableColumn text="Stock (kg)" prefWidth="100"/>
                                        <TableColumn text="Threshold" prefWidth="100"/>
                                        <TableColumn text="Current Price" prefWidth="120"/>
                                        <TableColumn text="Status" prefWidth="120"/>
                                    </columns>
                                </TableView>
                            </center>
                        </BorderPane>
                    </Tab>
                    
                    <!-- Orders Management Tab -->
                    <Tab text="Orders">
                        <BorderPane>
                            <top>
                                <HBox spacing="10" alignment="CENTER_LEFT" style="-fx-padding: 15; -fx-background-color: #f5f5f5;">
                                    <Label text="Filter by Status:" style="-fx-font-weight: bold;"/>
                                    <ComboBox fx:id="orderStatusFilter" promptText="All Orders" prefWidth="150"/>
                                    <Button text="Refresh" onAction="#handleRefreshOrders"/>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <Label fx:id="ordersCountLabel" text="Total: 0 orders" style="-fx-font-size: 12px;"/>
                                </HBox>
                            </top>
                            <center>
                                <TableView fx:id="ordersTable">
                                    <columns>
                                        <TableColumn text="Order ID" prefWidth="80"/>
                                        <TableColumn text="Customer" prefWidth="120"/>
                                        <TableColumn text="Carrier" prefWidth="120"/>
                                        <TableColumn text="Items" prefWidth="150"/>
                                        <TableColumn text="Total" prefWidth="100"/>
                                        <TableColumn text="Status" prefWidth="100"/>
                                        <TableColumn text="Order Date" prefWidth="130"/>
                                        <TableColumn text="Delivery Date" prefWidth="130"/>
                                    </columns>
                                </TableView>
                            </center>
                        </BorderPane>
                    </Tab>
                    
                    <!-- Carriers Management Tab -->
                    <Tab text="Carriers">
                        <BorderPane>
                            <top>
                                <HBox spacing="10" alignment="CENTER_LEFT" style="-fx-padding: 15; -fx-background-color: #f5f5f5;">
                                    <Button text="Hire Carrier" onAction="#handleHireCarrier" style="-fx-background-color: #4caf50; -fx-text-fill: white; -fx-font-weight: bold;"/>
                                    <Button text="Fire Carrier" onAction="#handleFireCarrier" style="-fx-background-color: #f44336; -fx-text-fill: white;"/>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <Button text="View Ratings" onAction="#handleViewCarrierRatings"/>
                                </HBox>
                            </top>
                            <center>
                                <TableView fx:id="carriersTable">
                                    <columns>
                                        <TableColumn text="ID" prefWidth="50"/>
                                        <TableColumn text="Username" prefWidth="150"/>
                                        <TableColumn text="Contact" prefWidth="200"/>
                                        <TableColumn text="Completed Deliveries" prefWidth="150"/>
                                        <TableColumn text="Current Deliveries" prefWidth="150"/>
                                        <TableColumn text="Avg Rating" prefWidth="100"/>
                                        <TableColumn text="Status" prefWidth="100"/>
                                    </columns>
                                </TableView>
                            </center>
                        </BorderPane>
                    </Tab>
                    
                    <!-- Messages Tab -->
                    <Tab text="Messages">
                        <HBox spacing="0" style="-fx-background-color: white; -fx-background-radius: 15;">
                            <!-- SOL MENÃœ: KONULAR -->
                            <VBox minWidth="300" spacing="0"
                                style="-fx-border-color: #e0e0e0; -fx-border-width: 0 1 0 0; -fx-background-color: #ffffff; -fx-background-radius: 15 0 0 15;">
                                <HBox alignment="CENTER_LEFT"
                                    style="-fx-padding: 20; -fx-background-color: #f0f2f5; -fx-background-radius: 15 0 0 0; -fx-border-color: #e0e0e0; -fx-border-width: 0 0 1 0;">
                                    <Label style="-fx-font-weight: bold; -fx-font-size: 18px; -fx-text-fill: #333;"
                                        text="ðŸ’¬ Customer Messages" />
                                </HBox>
                                <Button onAction="#handleRefreshMessages" maxWidth="Infinity" text="ðŸ”„ Refresh"
                                    style="-fx-background-color: #2196f3; -fx-text-fill: white; -fx-font-weight: bold; -fx-cursor: hand; -fx-padding: 12; -fx-background-radius: 0;" />
                                <ListView fx:id="chatTopicsList" VBox.vgrow="ALWAYS"
                                    style="-fx-background-color: transparent; -fx-border-width: 0; -fx-padding: 0; -fx-font-size: 13px;" />
                            </VBox>

                            <!-- SAÄž Ä°Ã‡ERÄ°K: MESAJLAÅžMA -->
                            <VBox HBox.hgrow="ALWAYS"
                                style="-fx-background-color: #efe7dd; -fx-background-radius: 0 15 15 0;">
                                <HBox alignment="CENTER_LEFT" spacing="15"
                                    style="-fx-background-color: #f0f2f5; -fx-padding: 15; -fx-background-radius: 0 15 0 0; -fx-border-color: #d1d7db; -fx-border-width: 0 0 1 0;">
                                    <VBox>
                                        <Label fx:id="chatCurrentTopicLabel" text="Select a conversation"
                                            style="-fx-text-fill: #111; -fx-font-weight: bold; -fx-font-size: 16px;" />
                                        <Label fx:id="chatCustomerNameLabel" text="Customer Name"
                                            style="-fx-text-fill: #777; -fx-font-size: 11px;" />
                                    </VBox>
                                    <Region HBox.hgrow="ALWAYS" />
                                    <Button onAction="#handleDeleteMessage" text="ðŸ—‘ Delete"
                                        style="-fx-background-color: #ffebee; -fx-text-fill: #c62828; -fx-font-size: 12px; -fx-cursor: hand; -fx-background-radius: 5;" />
                                </HBox>

                                <!-- Chat AlanÄ± -->
                                <ScrollPane fx:id="chatScroll" fitToWidth="true" fitToHeight="true"
                                    style="-fx-background: #efe7dd; -fx-background-color: #efe7dd; -fx-border-width: 0; -fx-padding: 0;"
                                    VBox.vgrow="ALWAYS">
                                    <content>
                                        <VBox fx:id="chatMessagesBox" spacing="15"
                                            style="-fx-padding: 20; -fx-background-color: #efe7dd;" />
                                    </content>
                                </ScrollPane>

                                <HBox spacing="10"
                                    style="-fx-background-color: #f0f2f5; -fx-padding: 15; -fx-background-radius: 0 0 15 0;">
                                    <TextField fx:id="chatInput" promptText="Type your message..." HBox.hgrow="ALWAYS"
                                        style="-fx-background-radius: 20; -fx-padding: 10;" />
                                    <Button onAction="#handleSendMessage" text="Send"
                                        style="-fx-background-color: #2196f3; -fx-text-fill: white; -fx-font-weight: bold; -fx-background-radius: 20; -fx-padding: 10 20;" />
                                </HBox>
                            </VBox>
                        </HBox>
                    </Tab>
                    
                    <!-- Settings Tab -->
                    <Tab text="Settings">
                        <ScrollPane fitToWidth="true" fitToHeight="true">
                            <VBox spacing="20" style="-fx-padding: 20;">
                                
                                <!-- Coupons Section -->
                                <VBox spacing="10" style="-fx-background-color: white; -fx-padding: 15; -fx-border-color: #e0e0e0; -fx-border-width: 1; -fx-border-radius: 5; -fx-background-radius: 5;">
                                    <HBox alignment="CENTER_LEFT" spacing="10">
                                        <Label text="Discount Coupons" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
                                        <Region HBox.hgrow="ALWAYS"/>
                                        <Button text="Add Coupon" onAction="#handleAddCoupon" style="-fx-background-color: #4caf50; -fx-text-fill: white; -fx-font-weight: bold;"/>
                                        <Button text="Update Coupon" onAction="#handleUpdateCoupon" style="-fx-background-color: #2196f3; -fx-text-fill: white;"/>
                                        <Button text="Remove Coupon" onAction="#handleRemoveCoupon" style="-fx-background-color: #f44336; -fx-text-fill: white;"/>
                                    </HBox>
                                    <Separator/>
                                    <TableView fx:id="couponsTable" prefHeight="200">
                                        <columns>
                                            <TableColumn text="Code" prefWidth="150"/>
                                            <TableColumn text="Discount Percent" prefWidth="120"/>
                                            <TableColumn text="Min Purchase" prefWidth="120"/>
                                            <TableColumn text="Valid Until" prefWidth="150"/>
                                            <TableColumn text="Status" prefWidth="100"/>
                                        </columns>
                                    </TableView>
                                </VBox>
                                
                                <!-- Loyalty Program Section -->
                                <VBox spacing="10" style="-fx-background-color: white; -fx-padding: 15; -fx-border-color: #e0e0e0; -fx-border-width: 1; -fx-border-radius: 5; -fx-background-radius: 5;">
                                    <Label text="Loyalty Program Settings" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
                                    <Separator/>
                                    <GridPane hgap="15" vgap="10">
                                        <Label text="Minimum Orders Required:" GridPane.columnIndex="0" GridPane.rowIndex="0"/>
                                        <TextField fx:id="minOrdersField" promptText="5" prefWidth="100" GridPane.columnIndex="1" GridPane.rowIndex="0"/>
                                        <Label text="Discount Percentage:" GridPane.columnIndex="0" GridPane.rowIndex="1"/>
                                        <TextField fx:id="loyaltyDiscountField" promptText="5.0" prefWidth="100" GridPane.columnIndex="1" GridPane.rowIndex="1"/>
                                        <Label text="percent" GridPane.columnIndex="2" GridPane.rowIndex="1"/>
                                    </GridPane>
                                    <Button text="Save Loyalty Settings" onAction="#handleSaveLoyaltySettings" 
                                            style="-fx-background-color: #2196f3; -fx-text-fill: white; -fx-font-weight: bold;" maxWidth="200"/>
                                </VBox>
                                
                                <!-- System Settings Section -->
                                <VBox spacing="10" style="-fx-background-color: white; -fx-padding: 15; -fx-border-color: #e0e0e0; -fx-border-width: 1; -fx-border-radius: 5; -fx-background-radius: 5;">
                                    <Label text="System Settings" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
                                    <Separator/>
                                    <GridPane hgap="15" vgap="10">
                                        <Label text="Minimum Cart Value:" GridPane.columnIndex="0" GridPane.rowIndex="0"/>
                                        <TextField fx:id="minCartValueField" promptText="50.00" prefWidth="100" GridPane.columnIndex="1" GridPane.rowIndex="0"/>
                                        <Label text="TL" GridPane.columnIndex="2" GridPane.rowIndex="0"/>
                                        <Label text="VAT Rate:" GridPane.columnIndex="0" GridPane.rowIndex="1"/>
                                        <TextField fx:id="vatRateField" text="18" prefWidth="100" editable="false" GridPane.columnIndex="1" GridPane.rowIndex="1"/>
                                        <Label text="percent" GridPane.columnIndex="2" GridPane.rowIndex="1"/>
                                    </GridPane>
                                    <Button text="Save Min Cart Value" onAction="#handleSaveMinCartValue" 
                                            style="-fx-background-color: #ff9800; -fx-text-fill: white; -fx-font-weight: bold;" maxWidth="200"/>
                                </VBox>
                                
                            </VBox>
                        </ScrollPane>
                    </Tab>
                    
                    <!-- Reports Tab -->
                    <Tab text="Reports">
                        <VBox spacing="15" style="-fx-padding: 20;">
                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <Label text="Report Type:" style="-fx-font-weight: bold;"/>
                                <ComboBox fx:id="reportTypeCombo" promptText="Select Report Type" prefWidth="200"/>
                                <Button text="Generate Report" onAction="#handleGenerateReport" style="-fx-background-color: #4caf50; -fx-text-fill: white;"/>
                                <Region HBox.hgrow="ALWAYS"/>
                                <Button text="Export to PDF" onAction="#handleExportReport"/>
                            </HBox>
                            <Separator/>
                            <ScrollPane fitToWidth="true" fitToHeight="true" VBox.vgrow="ALWAYS">
                                <VBox fx:id="reportContentBox" spacing="15" style="-fx-padding: 10;">
                                    <Label text="Select a report type and click Generate Report" 
                                           style="-fx-font-size: 14px; -fx-text-fill: #666; -fx-padding: 50;"/>
                                </VBox>
                            </ScrollPane>
                        </VBox>
                    </Tab>
                    
                </TabPane>
            </center>
            
        </BorderPane>
    </center>
    
    <!-- BOTTOM: Status bar -->
    <bottom>
        <HBox spacing="10" alignment="CENTER_LEFT" style="-fx-background-color: #e0e0e0; -fx-padding: 10;">
            <Label fx:id="statusLabel" text="Ready" style="-fx-font-size: 12px;"/>
        </HBox>
    </bottom>
    
</BorderPane>